(window.webpackJsonp=window.webpackJsonp||[]).push([[110],{1389:function(e,a,t){"use strict";t.r(a);var s=t(2955),r=t(1970);for(var n in r)"default"!==n&&function(e){t.d(a,e,function(){return r[e]})}(n);var d=t(0),i=t(2595),o=t.n(i),l=Object(d.a)(r.default,s.a,s.b,!1,null,null,null);"function"==typeof o.a&&o()(l),l.options.__file="create.vue",a.default=l.exports},1458:function(e,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.validateIPRangeList=a.validateDomain=a.validatePassword=a.validateSubdomain=a.validateUsername=a.validateDBUser=a.validateDatabase=a.validateDNSName=a.validateMXValue=a.validateDNSValue=a.validateFTP=a.validateEmail=a.validateForwarder=void 0;var s=d(t(49)),r=d(t(66)),n=d(t(1459));function d(e){return e&&e.__esModule?e:{default:e}}var i=s.default.get({url:"/CMD_JSON_VALIDATE",schema:{value:s.default.REQUIRED_STRING},response:{valid:!0,message:""},mapResponse:{valid:n.default.isValid,message:n.default.getMessage}}),o=(a.validateForwarder=i.extend({id:"VALIDATE_FORWARDER",params:{type:"forwarder"}}),a.validateEmail=i.extend({id:"VALIDATE_EMAIL",params:{type:"email",check_mailing_list:!0},schema:{check_exists:{type:Boolean,required:!1,default:!0}}}),a.validateFTP=i.extend({id:"VALIDATE_FTP",params:{type:"ftp"},domain:!0}),i.extend({params:{type:"dns"},domain:!0,schema:{record:s.default.REQUIRED_STRING}})),l=a.validateDNSValue=o.extend({id:"VALIDATE_DNS_VALUE",params:{check:"value",name:!0},domain:!0,schema:{value:s.default.REQUIRED_STRING}});a.validateMXValue=l.extend({id:"VALIDATE_MX_VALUE",params:{record:"MX"},before:function(e){return{value:"10",mx_value:e.value}}}),a.validateDNSName=o.extend({id:"VALIDATE_DNS_NAME",params:{check:"name",value:!0,mx_value:!0},schema:{name:s.default.REQUIRED_STRING,value:null}}),a.validateDatabase=i.extend({id:"VALIDATE_DATABASE",params:{type:"dbname"}}),a.validateDBUser=i.extend({id:"VALIDATE_DATABASE_USER",params:{type:"dbusername"}}),a.validateUsername=i.extend({id:"VALIDATE_USERNAME",params:{type:"username"}}),a.validateSubdomain=i.extend({id:"VALIDATE_SUBDOMAIN",domain:!0,params:{type:"subdomain"}}),a.validatePassword=i.extend({id:"VALIDATE_PASSWORD",params:{type:"password"}}),a.validateDomain=i.extend({id:"VALIDATE_DOMAIN",params:{type:"domain"},before:function(e){var a=e.value;return{value:r.default.toASCII(a)}}}),a.validateIPRangeList=i.extend({id:"VALIDATE_IP_RANGE_LIST",params:{type:"ip_range_list"}})},1459:function(e,a,t){"use strict";t.r(a);var s=t(91);a.default={isValid:function(e){return void 0===e.error},getMessage:function(e){return Object(s.toAppHtml)(e.error||"")}}},1484:function(e,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.setUserPrivs=a.getUserPrivs=a.changeUserPassword=a.assignUser=a.addUser=a.deleteAccessHost=a.addAccessHost=a.deleteUsers=a.getDatabase=a.uploadBackup=a.deleteDatabase=a.optimizeDatabase=a.checkDatabase=a.repairDatabase=a.getDatabases=a.createDatabase=a.getUsers=void 0;var s=n(t(6)),r=n(t(49));function n(e){return e&&e.__esModule?e:{default:e}}a.getUsers=r.default.get({id:"DB_USERS",url:"/CMD_DB_CREATE",domain:!0,after:function(e){return e.flow(e.toArray,e.filter(e.flow(e.getProp("text"),e.isEqual("..."),e.not)),e.mapArray(e.moveProp("label","text")))}}),a.createDatabase=r.default.post({url:"/CMD_DB",params:{action:"create"},domain:!0,schema:{name:r.default.REQUIRED_STRING,user:r.default.REQUIRED_STRING,passwd:r.default.OPTIONAL_STRING,passwd2:r.default.OPTIONAL_STRING,userlist:r.default.OPTIONAL_STRING},after:function(e){return e.mapProp("result",e.convert.toAppHtml)},updateTokens:!0}),a.getDatabases=r.default.get({id:"DATABASES",url:"/CMD_DB",domain:!0,schema:(0,s.default)({},r.default.PAGINATION),after:function(e){return e.mapProps({databases:e.toTable(e.mapArrayProps({nusers:e.convert.toAppNumber,size:e.convert.toAppNumber})),total_usage:e.convert.toAppNumber,dbs_select:e.toSelect})}});var d=r.default.select({url:"/CMD_DB",domain:!0,params:{json:!0}});a.repairDatabase=d.extend({params:{repair:!0}}),a.checkDatabase=d.extend({params:{check:!0}}),a.optimizeDatabase=d.extend({params:{optimize:!0}}),a.deleteDatabase=d.extend({params:{delete_db:!0},updateTokens:!0}),a.uploadBackup=r.default.post({url:"/CMD_DB",params:{action:"restore",method:"default"},domain:!0,schema:{name:r.default.REQUIRED_STRING,dbuser:r.default.REQUIRED_STRING,dbpass:r.default.REQUIRED_STRING,file:{type:File,required:!0}},before:function(e){return{file1:e.file,file:null}},transport:FormData}),a.getDatabase=r.default.get({id:"DB_VIEW",url:"/CMD_DB_VIEW",params:{page:1,ipp:9999},domain:!0,schema:{name:r.default.REQUIRED_STRING},after:function(e){return e.flow(e.project({hosts:"access_hosts",users:"db_users"}),e.mapValues(e.deleteProp("info")),e.mapProps({users:e.flow(e.toArray,e.mapArray(e.getProp("User"))),hosts:e.flow(e.toArray,e.mapArray(e.getProp("Access Hosts")))}))}}),a.deleteUsers=r.default.post({url:"/CMD_DB",method:"POST",params:{action:"deleteuser",delete:!0,json:!0},domain:!0,schema:{name:r.default.REQUIRED_STRING,select:r.default.ROWS}}),a.addAccessHost=r.default.post({url:"/CMD_DB_ACCESS",domain:!0,params:{add:!0,json:!0},schema:{name:r.default.REQUIRED_STRING,host:r.default.REQUIRED_STRING}}),a.deleteAccessHost=r.default.select({url:"/CMD_DB_ACCESS",domain:!0,params:{delete:!0,json:!0},schema:{name:r.default.REQUIRED_STRING}}),a.addUser=r.default.post({url:"/CMD_DB",domain:!0,params:{action:"createuser",json:!0},schema:{name:r.default.REQUIRED_STRING,passwd:r.default.REQUIRED_STRING,passwd2:r.default.REQUIRED_STRING}}),a.assignUser=r.default.post({url:"/CMD_DB",domain:!0,params:{action:"createuser",json:!0,passwd:"*****",passwd2:"*****"},schema:{name:r.default.REQUIRED_STRING,userlist:r.default.REQUIRED_STRING}}),a.changeUserPassword=r.default.post({url:"/CMD_DB",domain:!0,params:{action:"modifyuser",json:!0},schema:{name:r.default.REQUIRED_STRING,user:r.default.REQUIRED_STRING,passwd:r.default.REQUIRED_STRING,passwd2:r.default.REQUIRED_STRING}}),a.getUserPrivs=r.default.get({id:"DB_USER_PRIVS",url:"/CMD_DB_USER_PRIVS",domain:!0,schema:{name:r.default.REQUIRED_STRING,user:r.default.REQUIRED_STRING},after:function(e){return e.mapValues(e.isEqual("Y"))}}),a.setUserPrivs=r.default.post({url:"/CMD_DB_USER_PRIVS",domain:!0,params:{action:"save "},body:{name:r.default.REQUIRED_STRING,user:r.default.REQUIRED_STRING}})},1970:function(e,a,t){"use strict";t.r(a);var s=t(1971),r=t.n(s);for(var n in s)"default"!==n&&function(e){t.d(a,e,function(){return s[e]})}(n);a.default=r.a},1971:function(e,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var s=i(t(16)),r=i(t(17)),n=t(1458),d=t(1484);function i(e){return e&&e.__esModule?e:{default:e}}a.default={preload:d.getUsers,api:[{command:d.getUsers,bind:"users"},{command:n.validateDBUser,bind:"dbUserValidation"}],commands:{validateDatabase:n.validateDatabase,validatePassword:n.validatePassword},data:function(){return{dbName:"",dbUser:"",dbPassword:"",copyDBName:!0}},computed:{dbUsers:function(){return this.$api.users.map(function(e){return e.value})},existingUser:function(){var e=this;return!!this.dbUsers.find(function(a){return a===e.dbUser})}},watch:{dbName:function(e){e&&this.copyDBName&&(this.dbUser=e)}},methods:{createDatabase:function(){var e=this;return(0,r.default)(s.default.mark(function a(){return s.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(0,d.createDatabase)({name:e.dbName,user:e.dbUser,passwd:e.existingUser?"******":e.dbPassword,passwd2:e.existingUser?"******":e.dbPassword,userlist:e.existingUser?e.dbUser:"..."});case 2:a.sent&&(e.$store.dispatch("app/GET_TOKENS"),e.$router.push({name:"user/database"}));case 4:case"end":return a.stop()}},a,e)}))()},usernameValidation:function(e){var a=this;return(0,r.default)(s.default.mark(function t(){var r,d;return s.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e&&!a.existingUser){t.next=2;break}return t.abrupt("return",!0);case 2:return t.next=4,(0,n.validateDBUser)({value:e});case 4:return r=t.sent,d=r.valid,t.abrupt("return",d);case 7:case"end":return t.stop()}},t,a)}))()}}}},2595:function(e,a){},2955:function(e,a,t){"use strict";var s=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("app-page",[t("app-page-section",[t("ui-form-element",{attrs:{group:"database",validators:{required:!0,api:e.$commands.validateDatabase},vertical:e.$_Client.isPhone}},[t("translate",{attrs:{slot:"title"},slot:"title"},[e._v("Database Name:")]),e._v(" "),t("input-text",{attrs:{slot:"content",prefix:e.$state.app.user.name+"_"},slot:"content",model:{value:e.dbName,callback:function(a){e.dbName=a},expression:"dbName"}})],1),e._v(" "),t("ui-form-element",{attrs:{group:"database",validators:{required:!0,usernameValidation:e.usernameValidation},vertical:e.$_Client.isPhone,underline:!!e.dbUser&&!e.existingUser}},[t("translate",{attrs:{slot:"title"},slot:"title"},[e._v("Database User:")]),e._v(" "),t("input-autocomplete",{attrs:{slot:"content",values:e.dbUsers,disabled:e.copyDBName},slot:"content",model:{value:e.dbUser,callback:function(a){e.dbUser=a},expression:"dbUser"}},[t("template",{slot:"additions:left"},[e._v("\n                    "+e._s(e.$state.app.user.name)+"_\n                ")]),e._v(" "),t("input-checkbox-button",{attrs:{slot:"additions:right"},slot:"additions:right",model:{value:e.copyDBName,callback:function(a){e.copyDBName=a},expression:"copyDBName"}},[t("translate",[e._v("Same as database name")])],1)],2),e._v(" "),t("span",{attrs:{slot:"error:usernameValidation"},domProps:{innerHTML:e._s(e.$api.dbUserValidation.message)},slot:"error:usernameValidation"})],1),e._v(" "),e.dbUser&&!e.existingUser?t("ui-form-element",{attrs:{group:"database",validators:{required:!0,api:e.$commands.validatePassword},vertical:e.$_Client.isPhone,underline:!1}},[t("translate",{attrs:{slot:"title"},slot:"title"},[e._v("Database Password:")]),e._v(" "),t("input-password",{attrs:{slot:"content",showGenerator:""},slot:"content",model:{value:e.dbPassword,callback:function(a){e.dbPassword=a},expression:"dbPassword"}})],1):e._e()],1),e._v(" "),t("ui-button",{attrs:{slot:"footer:buttons",disabled:!e.$valid("database"),theme:"safe"},on:{click:e.createDatabase},slot:"footer:buttons"},[t("translate",[e._v("Create Database")])],1)],1)},r=[];t.d(a,"a",function(){return s}),t.d(a,"b",function(){return r})}}]);